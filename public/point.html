<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>í¬ì¸íŠ¸ ì•ˆë‚´</title>

<style>
body{
  margin:0;
  background:#111;
  color:white;
  font-family:Arial;
}

.wrap{
  max-width:420px;
  margin:auto;
  padding:20px;
}

.card{
  background:#1a1a1a;
  padding:18px;
  border-radius:14px;
  margin-bottom:14px;
}

h2{ margin-top:0; }

.point{
  font-size:22px;
  font-weight:bold;
  color:#ffd56b;
}

button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:#ffd56b;
  font-weight:bold;
  cursor:pointer;
}

.row{
  display:flex;
  gap:10px;
  margin-top:12px;
}

button.secondary{
  background:#2a2a2a;
  color:white;
  font-weight:normal;
}

.small{
  font-size:12px;
  opacity:.75;
  margin-top:8px;
  line-height:1.4;
  word-break:break-word;
}
</style>
</head>

<body>

<div class="wrap">

  <div class="card">
    <h2>ğŸ ë‚´ í¬ì¸íŠ¸</h2>
    <div id="userInfo">ë¡œê·¸ì¸ í•„ìš”</div>
    <div id="pointBox" class="point">0ì </div>

    <div id="metaLine" class="small"></div>

    <div class="row">
      <button id="btnCheckin">ì¶œì„ ì²´í¬ (+10)</button>
      <button id="btnUse" class="secondary">ì»¨í…ì¸  ì´ìš© (+1)</button>
    </div>

    <div id="loginHint" class="small" style="display:none;">
      í¬ì¸íŠ¸ ê¸°ëŠ¥ì€ ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. ë©”ì¸ì—ì„œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.
    </div>

    <div id="sysHint" class="small" style="display:none;"></div>
  </div>

  <div class="card">
    <h2>ğŸ“œ ì•±í…Œí¬ ê·œì¹™</h2>
    <p>â€¢ ì¶œì„ ì²´í¬: +10ì </p>
    <p>â€¢ ì»¨í…ì¸  ì´ìš©: +1ì </p>
    <p>â€¢ ì¹œêµ¬ ì´ˆëŒ€: ì–‘ìª½ +100ì </p>
    <br>
    <p>ğŸ’° 1ì  = 1ì›</p>
    <p>ğŸ’³ 5,000ì ë¶€í„° ì¶œê¸ˆ ê°€ëŠ¥</p>
  </div>

  <button onclick="location.href='/'">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>

</div>

<!-- âœ… API URLì€ config.jsì—ì„œë§Œ ê´€ë¦¬ -->
<script src="/js/config.js"></script>
<script src="/js/points.js"></script>

<script>
function setSysHint(msg){
  const el = document.getElementById("sysHint");
  if(!el) return;
  el.style.display = "block";
  el.textContent = msg;
}

async function renderPoint(){
  const phone = localStorage.getItem("phone");
  const name = localStorage.getItem("name") || "íšŒì›";

  const btnCheckin = document.getElementById("btnCheckin");
  const btnUse = document.getElementById("btnUse");

  // âœ… points.jsê°€ ì •ìƒ ë¡œë“œë˜ì—ˆëŠ”ì§€ ì²´í¬
  const hasPointsFns = (typeof window.loadMyPoint === "function") &&
                       (typeof window.checkinPoint === "function") &&
                       (typeof window.givePoint === "function");

  if(!hasPointsFns){
    setSysHint("ì‹œìŠ¤í…œ ë¡œë”©ì´ ì•„ì§ ì™„ë£Œë˜ì§€ ì•Šì•˜ê±°ë‚˜(points.js ë¯¸ë¡œë“œ), ë„¤íŠ¸ì›Œí¬ ë¬¸ì œì¼ ìˆ˜ ìˆì–´ìš”. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
    if(btnCheckin) btnCheckin.disabled = true;
    if(btnUse) btnUse.disabled = true;
  }else{
    const hint = document.getElementById("sysHint");
    if(hint) hint.style.display = "none";
  }

  if(!phone){
    document.getElementById("userInfo").textContent = "ë¡œê·¸ì¸ í•„ìš”";
    document.getElementById("pointBox").textContent = "0ì ";
    document.getElementById("metaLine").textContent = "ë¡œê·¸ì¸ í›„ í¬ì¸íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.";
    document.getElementById("loginHint").style.display = "block";

    if(btnCheckin) btnCheckin.disabled = true;
    if(btnUse) btnUse.disabled = true;
    return;
  }

  document.getElementById("loginHint").style.display = "none";
  document.getElementById("userInfo").textContent = `${name}ë‹˜`;

  // âœ… ì•ˆì „ í˜¸ì¶œ
  let p = 0;
  try{
    p = await window.loadMyPoint();
  }catch(e){
    setSysHint("í¬ì¸íŠ¸ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
    console.warn(e);
    p = Number(localStorage.getItem("point") || "0");
  }

  const num = Number(p);
  document.getElementById("pointBox").textContent =
    (Number.isFinite(num) ? num.toLocaleString() : "0") + "ì ";

  document.getElementById("metaLine").textContent =
    "ì „í™”ë²ˆí˜¸: " + phone + " Â· (API: config.js)";

  // ë¡œê·¸ì¸ ìƒíƒœë©´ ë²„íŠ¼ í™œì„±
  if(btnCheckin) btnCheckin.disabled = false;
  if(btnUse) btnUse.disabled = false;
}

// ë²„íŠ¼ ì´ë²¤íŠ¸
document.getElementById("btnCheckin")?.addEventListener("click", async ()=>{
  if(typeof window.checkinPoint !== "function"){
    alert("ì‹œìŠ¤í…œ ë¡œë”©ì´ ì•„ì§ ëë‚˜ì§€ ì•Šì•˜ì–´ìš”. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
    return;
  }
  await window.checkinPoint();
  await renderPoint();
});

document.getElementById("btnUse")?.addEventListener("click", async ()=>{
  if(typeof window.givePoint !== "function"){
    alert("ì‹œìŠ¤í…œ ë¡œë”©ì´ ì•„ì§ ëë‚˜ì§€ ì•Šì•˜ì–´ìš”. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
    return;
  }
  await window.givePoint();
  await renderPoint();
});

// âœ… ì‹¤í–‰ íƒ€ì´ë° ì•ˆì •í™”
document.addEventListener("DOMContentLoaded", ()=>{
  renderPoint();
});
</script>

</body>
</html>
